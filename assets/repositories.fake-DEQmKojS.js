import{f as i}from"./faker-DeUhq2Z5.js";import{u as w,P as c}from"./index-nxo0BqrM.js";var g={};class R{async generateTitle(){return`The Great Battle of ${i.number.int({min:1990,max:2050})}`}async generateSubtitle(){return i.lorem.words({min:2,max:5})}async generateOverview(){return"An epic battle that changed the course of history."}async generateNarrative(){return i.lorem.paragraph()}}class b{async getKomaeBase(){const{imageUrl:e,title:t,subtitle:a,description:n}=c.Komae;return{imageUrl:e,title:t,subtitle:a,description:n}}async getYonoBase(){const{imageUrl:e,title:t,subtitle:a,description:n}=c.Yono;return{imageUrl:e,title:t,subtitle:a,description:n}}}function m(){return(typeof process<"u"?g:void 0)?.NODE_ENV==="test"}async function l(o,e){await new Promise((t,a)=>{if(e?.aborted)return a(new DOMException("Aborted","AbortError"));const n=setTimeout(t,o),r=()=>{clearTimeout(n),a(new DOMException("Aborted","AbortError"))};e&&e.addEventListener("abort",r,{once:!0})})}const s=1e4;function p(o){if(!o)return 0;if(typeof o=="number"){let r=Math.max(0,Math.floor(o));return r>s&&(console.warn(`[FakeRepo] Delay capped at ${s}ms (requested: ${r}ms)`),r=s),r}let e=Math.max(0,Math.floor(o.min)),t=Math.max(e,Math.floor(o.max));if(e>s||t>s){const r={min:e,max:t};e=Math.min(e,s),t=Math.min(Math.max(e,t),s),console.warn(`[FakeRepo] Delay range capped to <= ${s}ms (requested: min=${r.min}ms, max=${r.max}ms; capped: min=${e}ms, max=${t}ms)`)}const n=t-e;return n<=0?e:e+Math.floor(Math.random()*(n+1))}class x{scenarioRepo;netaRepo;delay;constructor(e,t,a){this.scenarioRepo=e??new R,this.netaRepo=t??new b,this.delay=a?.delay}async generateReport(e){const t=p(this.delay);t>0&&!m()&&await l(t,e?.signal);const[a,n,r,u,d,y]=await Promise.all([this.scenarioRepo.generateTitle(),this.scenarioRepo.generateSubtitle(),this.scenarioRepo.generateOverview(),this.scenarioRepo.generateNarrative(),this.netaRepo.getKomaeBase(),this.netaRepo.getYonoBase()]),h={...d,power:i.number.int({min:0,max:100})},f={...y,power:i.number.int({min:0,max:100})};return{id:w("battle"),title:a,subtitle:n,overview:r,scenario:u,komae:h,yono:f,status:"success"}}}class A{delay;constructor(e){this.delay=e?.delay}async determineWinner(e,t){const a=p(this.delay);a>0&&!m()&&await l(a,t?.signal);const{yono:n,komae:r}=e;return n.power>r.power?"YONO":n.power<r.power?"KOMAE":"DRAW"}}export{x as FakeBattleReportRepository,A as FakeJudgementRepository,b as FakeNetaRepository,R as FakeScenarioRepository};
