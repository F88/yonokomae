import{a as i}from"./delay-utils-lugK4fzg.js";class c extends Error{status;constructor(t,e){super(t),this.name="HttpError",this.status=e}}class f{baseUrl;token;constructor(t,e){this.baseUrl=t,this.token=e}async get(t,e,a){const s=await fetch(`${this.baseUrl}${t}`,{headers:{...this.token?{Authorization:`Bearer ${this.token}`}:void 0,...a},signal:e});if(!s.ok)throw new c(`HTTP ${s.status}`,s.status);return s.json()}}class b{api;delay;constructor(t,e){this.api=t,this.delay=e?.delay}async generateReport(t){return await i(this.delay,t?.signal),this.api.get("/battle/report",t?.signal)}}class g{api;delay;constructor(t,e){this.api=t,this.delay=e?.delay}async determineWinner(t,e){await i(this.delay,e?.signal);const a=t.mode.id,s=JSON.stringify({battleId:t.battle.id,mode:a}),n=u(s),o=`/battle/judgement?mode=${encodeURIComponent(a)}`;return p(this.api,o,e?.signal,{"X-Idempotency-Key":n})}}function d(r,t){return new Promise((e,a)=>{const s=setTimeout(e,r);if(t){const n=()=>{clearTimeout(s),a(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",n,{once:!0})}})}async function p(r,t,e,a){let s=0;const n=2;for(;;)try{return await r.get(t,e,a)}catch(o){if(s++,!(o instanceof c&&o.status>=500&&o.status<=599)||s>=n)throw o;const l=200*Math.pow(2,s-1),h=Math.floor(Math.random()*100);await d(l+h,e)}}function u(r){let t=2166136261;for(let e=0;e<r.length;e++)t^=r.charCodeAt(e),t=t+((t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24))>>>0;return t.toString(36)}export{b as ApiBattleReportRepository,f as ApiClient,g as ApiJudgementRepository};
