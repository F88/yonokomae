import{u as c}from"./index-Codwol-l.js";import{a as l}from"./delay-utils-lugK4fzg.js";class u{api;delay;cacheTtlMs;cache=null;constructor(e,a){this.api=e,this.delay=a?.delay,this.cacheTtlMs=Math.max(0,a?.cacheTtlMs??3e4)}async generateReport(e){await l(this.delay,e?.signal);const a=Date.now();if(this.cache&&this.cache.expiresAt>a)return this.cache.value;try{const t=await this.generateFromIpify(e?.signal);return this.maybeStoreCache(t),t}catch{const t=await this.api.get("/news/battle/report",e?.signal);return this.maybeStoreCache(t),t}}maybeStoreCache(e){this.cacheTtlMs!==0&&(this.cache={value:e,expiresAt:Date.now()+this.cacheTtlMs})}async generateFromIpify(e){const a=await fetch("https://api.ipify.org?format=json",{headers:{Accept:"application/json"},signal:e});if(!a.ok)throw new Error(`ipify HTTP ${a.status}`);const t=await a.json(),i=typeof t?.ip=="string"&&t.ip?t.ip:"0.0.0.0",r=i.replace(/[^\d]/g,""),s=r?parseInt(r.slice(-6),10):42,o=s%50+25,n=Math.floor(s/7)%50+25;return{id:c("battle"),title:`IPアドレス ${i}`,subtitle:"Generated from ipify.org",overview:"A network-sourced battle report generated from your current public IP.",scenario:"Signal intelligence gathered from ipify inspires a spontaneous skirmish.",provenance:[{label:"ipify - A Simple Public IP Address API",url:"https://ipify.org",note:"The public IP address used to generate this report."}],yono:{imageUrl:"/yonokomae/YONO-SYMBOL.png",title:"Yono - IP Signal",subtitle:"Live network signal",description:"インターネット便利ねー",power:o},komae:{imageUrl:"/yonokomae/KOMAE-SYMBOL.png",title:"Komae - IP Signal",subtitle:"Live network signal",description:"インターネット便利なー",power:n},status:"success"}}}export{u as NewsReporterApiBattleReportRepository};
