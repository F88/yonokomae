import{a as n}from"./delay-utils-lugK4fzg.js";class c extends Error{status;constructor(t,e){super(t),this.name="HttpError",this.status=e}}class g{baseUrl;token;constructor(t,e){this.baseUrl=t,this.token=e}async get(t,e,a){const r=await fetch(`${this.baseUrl}${t}`,{headers:{...this.token?{Authorization:`Bearer ${this.token}`}:void 0,...a},signal:e});if(!r.ok)throw new c(`HTTP ${r.status}`,r.status);return r.json()}}class f{api;delay;constructor(t,e){this.api=t,this.delay=e?.delay}async generateReport(t){return await n(this.delay,t?.signal),this.api.get("/battle/report",t?.signal)}}class b{api;delay;constructor(t,e){this.api=t,this.delay=e?.delay}async determineWinner(t,e){await n(this.delay,e?.signal);const a=JSON.stringify({battleId:t.battle.id,judge:t.judge.id}),r=p(a);return d(this.api,"/battle/judgement",e?.signal,{"X-Idempotency-Key":r})}}function u(s,t){return new Promise((e,a)=>{const r=setTimeout(e,s);if(t){const o=()=>{clearTimeout(r),a(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",o,{once:!0})}})}async function d(s,t,e,a){let r=0;const o=2;for(;;)try{return await s.get(t,e,a)}catch(i){if(r++,!(i instanceof c&&i.status>=500&&i.status<=599)||r>=o)throw i;const l=200*Math.pow(2,r-1),h=Math.floor(Math.random()*100);await u(l+h,e)}}function p(s){let t=2166136261;for(let e=0;e<s.length;e++)t^=s.charCodeAt(e),t=t+((t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24))>>>0;return t.toString(36)}export{f as ApiBattleReportRepository,g as ApiClient,b as ApiJudgementRepository};
