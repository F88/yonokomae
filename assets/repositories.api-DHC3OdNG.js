import{a as s}from"./delay-utils-lugK4fzg.js";import{HttpError as p}from"./api-client-C0eAZ8kc.js";import{ApiClient as A}from"./api-client-C0eAZ8kc.js";class g{api;delay;constructor(t,e){this.api=t,this.delay=e?.delay}async generateReport(t){return await s(this.delay,t?.signal),this.api.get("/battle/report",t?.signal)}}class b{api;delay;constructor(t,e){this.api=t,this.delay=e?.delay}async determineWinner(t,e){await s(this.delay,e?.signal);const i=JSON.stringify({battleId:t.battle.id,judge:t.judge.id}),r=h(i);return y(this.api,"/battle/judgement",e?.signal,{"X-Idempotency-Key":r})}}function d(a,t){return new Promise((e,i)=>{const r=setTimeout(e,a);if(t){const o=()=>{clearTimeout(r),i(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",o,{once:!0})}})}async function y(a,t,e,i){let r=0;const o=2;for(;;)try{return await a.get(t,e,i)}catch(n){if(r++,!(n instanceof p&&n.status>=500&&n.status<=599)||r>=o)throw n;const c=200*Math.pow(2,r-1),l=Math.floor(Math.random()*100);await d(c+l,e)}}function h(a){let t=2166136261;for(let e=0;e<a.length;e++)t^=a.charCodeAt(e),t=t+((t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24))>>>0;return t.toString(36)}export{g as ApiBattleReportRepository,A as ApiClient,b as ApiJudgementRepository};
